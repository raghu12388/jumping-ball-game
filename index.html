<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Jumping Ball</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

<style>
html, body {
  margin:0; padding:0; height:100%;
  background:#0b0b0b; overflow:hidden;
  touch-action: manipulation;
  font-family: Arial, sans-serif;
}
canvas {
  display:block;
  background:#1c1c1c;
}

/* START OVERLAY */
#startOverlay {
  position: fixed;
  inset: 0;
  display:flex;
  align-items:center;
  justify-content:center;
  background: rgba(0,0,0,0.6);
  z-index: 10;
  pointer-events: auto;
}
#startBtn {
  background:#ff3b3b;
  color:#fff;
  padding:16px 28px;
  font-size:22px;
  border-radius:14px;
  border:none;
}
</style>
</head>

<body>

<div id="startOverlay">
  <button id="startBtn">â–¶ Start Game</button>
</div>

<canvas id="game"></canvas>

<script>
/* -------- TELEGRAM INIT -------- */
if (window.Telegram && Telegram.WebApp) {
  Telegram.WebApp.ready();
  Telegram.WebApp.expand();
}

/* -------- CANVAS -------- */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize(); window.addEventListener("resize", resize);

/* -------- GAME STATE -------- */
let started = false;
let gameOver = false;
let score = 0;
let frame = 0;

/* -------- BALL -------- */
const ball = {
  x: () => canvas.width / 2,
  y: canvas.height / 2,
  r: 15,
  dy: 0,
  g: 0.5,
  j: -10
};

/* -------- OBSTACLES -------- */
let obs = [];
function spawn(){
  const w = Math.random()*(canvas.width*0.6)+60;
  obs.push({x:Math.random()*(canvas.width-w), y:-20, w, h:14});
}

/* -------- DRAW -------- */
function drawBall(){
  ctx.beginPath();
  ctx.arc(ball.x(), ball.y, ball.r, 0, Math.PI*2);
  ctx.fillStyle="#ff3b3b";
  ctx.fill();
}
function drawObs(){
  ctx.fillStyle="#fff";
  obs.forEach(o=>ctx.fillRect(o.x,o.y,o.w,o.h));
}
function drawScore(){
  ctx.fillStyle="#fff";
  ctx.font="20px Arial";
  ctx.fillText("Score: "+score, 15, 30);
}

/* -------- UPDATE -------- */
function updBall(){
  ball.dy += ball.g;
  ball.y += ball.dy;
  if(ball.y + ball.r > canvas.height) gameOver = true;
}
function updObs(){
  obs.forEach(o=>{
    o.y += 3;
    if(
      ball.x()>o.x && ball.x()<o.x+o.w &&
      ball.y+ball.r>o.y && ball.y+ball.r<o.y+o.h
    ) gameOver = true;
  });
  obs = obs.filter(o=>o.y < canvas.height);
}

/* -------- LOOP -------- */
function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(!started){
    drawBall();
    requestAnimationFrame(loop);
    return;
  }

  if(gameOver){
    ctx.fillStyle="#000";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle="#fff";
    ctx.font="28px Arial";
    ctx.textAlign="center";
    ctx.fillText("Game Over", canvas.width/2, canvas.height/2);
    ctx.fillText("Score: "+score, canvas.width/2, canvas.height/2+40);
    ctx.textAlign="left";
    return;
  }

  drawBall();
  drawObs();
  updBall();
  updObs();
  drawScore();

  frame++;
  if(frame % 80 === 0){
    spawn();
    score++;
  }
  requestAnimationFrame(loop);
}

/* -------- START GAME -------- */
function startGame(){
  if(started) return;
  started = true;
  ball.dy = ball.j;
  document.getElementById("startOverlay").style.display="none";
}

/* -------- INPUT FIX -------- */
document.getElementById("startBtn").addEventListener("click", startGame);
document.getElementById("startBtn").addEventListener("touchstart", startGame);

canvas.addEventListener("mousedown", ()=>{ if(started && !gameOver) ball.dy=ball.j; });
canvas.addEventListener("touchstart", ()=>{ if(started && !gameOver) ball.dy=ball.j; });

/* -------- START LOOP -------- */
loop();
</script>

</body>
</html>


