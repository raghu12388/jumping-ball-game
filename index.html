<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Helix Jump 3D</title>

<!-- ðŸ”¥ TELEGRAM SAFE VIEWPORT -->
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<style>
html,body{
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  overflow:hidden;
  background:#87ceeb;
  touch-action:none;
}
canvas{
  position:fixed;
  top:0;left:0;
  width:100%;
  height:100%;
}
#ui,#hint,#revive{
  position:fixed;
  z-index:10;
  color:#fff;
  font-family:Arial, sans-serif;
  background:rgba(0,0,0,0.45);
  padding:8px 12px;
  border-radius:8px;
}
#ui{top:10px;left:10px}
#hint{top:10px;left:50%;transform:translateX(-50%)}
#revive{
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  display:none;text-align:center
}
button{
  margin-top:10px;
  padding:8px 14px;
  border:none;border-radius:6px;
  background:#00cc44;color:#000;font-weight:bold
}
</style>
</head>

<body>

<div id="ui">
Score: <span id="score">0</span><br>
Coins: <span id="coins">0</span>
</div>

<div id="hint">Tap = Jump Â· Drag = Rotate</div>

<div id="revive">
  <div>ðŸ’€ Game Over</div>
  <div>Use 20 Coins to Revive?</div>
  <button id="yes">YES</button>
  <button id="no">NO</button>
</div>

<script src="https://unpkg.com/three@0.152.2/build/three.min.js"></script>

<script>
/* ================= TELEGRAM INIT ================= */
if (window.Telegram && Telegram.WebApp) {
  Telegram.WebApp.ready();

  // FULLSCREEN
  Telegram.WebApp.expand();

  // MATCH COLORS
  Telegram.WebApp.setHeaderColor("#000000");
  Telegram.WebApp.setBackgroundColor("#87ceeb");

  // BACK BUTTON HANDLING
  Telegram.WebApp.BackButton.show();
  Telegram.WebApp.BackButton.onClick(() => {
    if (confirm("Exit game?")) {
      Telegram.WebApp.close();
    }
  });
}

/* ================= STORAGE ================= */
let coins = parseInt(localStorage.getItem("coins") || "0");
document.getElementById("coins").textContent = coins;

/* ================= UI ================= */
let score = 0;
const scoreEl = document.getElementById("score");
const coinsEl = document.getElementById("coins");
const addScore = v => scoreEl.textContent = (score += v);
const addCoins = v => {
  coins += v;
  localStorage.setItem("coins", coins);
  coinsEl.textContent = coins;
};

/* ================= THREE SETUP ================= */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

const camera = new THREE.PerspectiveCamera(70, innerWidth/innerHeight, 0.1, 100);
camera.position.set(5,6,5);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.2));
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

/* ================= LIGHT ================= */
scene.add(new THREE.AmbientLight(0xffffff,0.7));
const dl = new THREE.DirectionalLight(0xffffff,0.8);
dl.position.set(5,10,5);
scene.add(dl);

/* ================= TOWER ================= */
scene.add(new THREE.Mesh(
  new THREE.CylinderGeometry(1.2,1.2,20,32),
  new THREE.MeshStandardMaterial({color:0x00ffd5})
));

/* ================= PLATFORMS ================= */
const platforms=[], types=[
  {t:"safe",c:0x00cc44},
  {t:"break",c:0xffcc00},
  {t:"kill",c:0xff0000}
];

for(let i=0;i<14;i++){
  const cfg = types[Math.floor(Math.random()*types.length)];
  const ring = new THREE.Mesh(
    new THREE.TorusGeometry(1.6,0.25,16,50),
    new THREE.MeshStandardMaterial({color:cfg.c})
  );
  ring.rotation.x = Math.PI/2;
  ring.position.y = 6 - i*1.3;
  ring.userData = {type:cfg.t, broken:false};
  scene.add(ring);
  platforms.push(ring);
}

/* ================= BALL ================= */
const ball = new THREE.Mesh(
  new THREE.SphereGeometry(0.35,32,32),
  new THREE.MeshStandardMaterial({color:0xff0000, emissive:0x330000})
);
ball.position.set(2.2,6.5,0);
scene.add(ball);

/* ================= PHYSICS ================= */
let vel = 0, dead = false;
const gravity = -0.02;

/* ================= CONTROLS ================= */
let drag=false,lastX=0;
addEventListener("pointerdown",e=>{
  if(dead) return;
  drag=true; lastX=e.clientX; vel=.28;
});
addEventListener("pointerup",()=>drag=false);
addEventListener("pointermove",e=>{
  if(!drag) return;
  const dx=e.clientX-lastX;
  platforms.forEach(p=>p.rotation.z+=dx*.005);
  lastX=e.clientX;
});

/* ================= REVIVE ================= */
const reviveBox=document.getElementById("revive");
document.getElementById("yes").onclick=()=>{
  if(coins>=20){
    addCoins(-20);
    reviveBox.style.display="none";
    ball.position.y+=2;
    vel=.25; dead=false;
  }
};
document.getElementById("no").onclick=resetGame;

function resetGame(){
  reviveBox.style.display="none";
  ball.position.set(2.2,6.5,0);
  vel=0; dead=false;
  score=0; scoreEl.textContent=0;
  camera.position.set(5,6,5);
}

/* ================= RESIZE ================= */
addEventListener("resize",()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});

/* ================= LOOP ================= */
function loop(){
  requestAnimationFrame(loop);
  if(dead){ renderer.render(scene,camera); return; }

  vel += gravity;
  ball.position.y += vel;

  camera.position.y += (ball.position.y+3-camera.position.y)*.08;
  camera.lookAt(0, ball.position.y-1, 0);

  platforms.forEach(p=>{
    if(!p.userData.broken &&
      ball.position.y>p.position.y &&
      ball.position.y<p.position.y+.25 && vel<0){
      if(p.userData.type==="safe"){
        vel=.28; addScore(5); addCoins(5);
      }
      if(p.userData.type==="break"){
        scene.remove(p); p.userData.broken=true;
        vel=.28; addScore(10); addCoins(10);
      }
      if(p.userData.type==="kill"){
        dead=true; reviveBox.style.display="block";
      }
    }
  });

  if(ball.position.y<-12 && !dead){
    dead=true; reviveBox.style.display="block";
  }

  renderer.render(scene,camera);
}
loop();
</script>
</body>
</html>











